@model List<MVCRestaurante.Models.Menu>
@using MVCRestaurante.Filters
@{
    var esAdmin = User.Identity.IsAuthenticated;
}

<div class="container mt-5" style="padding: 100px 0 100px 0;">
    <h2 class="text-center mb-4">📜 Menús Disponibles</h2>

    @if (esAdmin)
    {
        <div class="d-flex justify-content-center mb-4">
            <a href="@Url.Action("Crear", "Menu")" class="btn btn-success">
                ➕ Crear Nuevo Menú
            </a>
        </div>
    }

    <div class="d-flex flex-column align-items-center">
        @foreach (var menu in Model)
        {
            <div class="card mb-3 shadow-sm position-relative" style="width: 50%;">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">@menu.NombreMenu</h5>
                    <a href="~/images/menu/@menu.PdfRuta" target="_blank" class="btn btn-custom">
                        📄 Ver Menú
                    </a>
                </div>

                @if (esAdmin)
                {
                    <div class="position-absolute top-0 end-0 p-2">
                        <a href="@Url.Action("Editar", "Menu", new { id = menu.IdMenu })" class="btn btn-warning btn-sm me-2">
                            ✏ Editar
                        </a>
                        <button class="btn btn-danger btn-sm eliminar-menu" data-id="@menu.IdMenu">
                            🗑 Eliminar
                        </button>
                    </div>
                }
            </div>
        }
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".eliminar-menu").forEach(button => {
            button.addEventListener("click", function () {
                let menuId = this.dataset.id;
                if (confirm("¿Seguro que deseas eliminar este menú?")) {
                    fetch(`/Menu/Eliminar/${menuId}`, {
                        method: "POST"
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert("Menú eliminado correctamente.");
                            location.reload();
                        } else {
                            alert("Error al eliminar el menú.");
                        }
                    })
                    .catch(error => console.error("Error:", error));
                }
            });
        });
    });
</script>
